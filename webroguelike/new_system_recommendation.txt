# 로그라이크 신규 시스템 추천: "축복과 저주"

## 1. 시스템 개요

"축복과 저주" 시스템은 플레이어가 새로운 층(맵)에 진입할 때마다 무작위로 긍정적인 효과("축복") 또는 부정적인 효과("저주")를 부여받는 시스템입니다. 이 효과는 다음 층으로 이동하기 전까지 지속되며, 매번 새로운 플레이 경험을 제공하여 로그라이크의 핵심 재미 요소인 "다양성"과 "적응"을 극대화합니다.

## 2. 핵심 컨셉

- **무작위성:** 매 층마다 어떤 축복이나 저주가 나타날지 예측할 수 없어, 플레이어는 항상 새로운 도전에 직면하게 됩니다.
- **상황 적응:** 부여된 효과에 맞춰 스킬, 장비, 플레이 스타일을 유연하게 변경해야 합니다. 예를 들어, "물리 공격력 증가" 축복을 받으면 전사 스킬 위주로, "마나 재생량 감소" 저주를 받으면 마나 소모가 적은 스킬 위주로 운영해야 합니다.
- **위험과 보상:** 강력한 축복은 플레이어에게 큰 이점을 주지만, 치명적인 저주는 한순간에 게임을 어렵게 만들 수 있습니다. 이는 플레이어에게 긴장감과 성취감을 동시에 제공합니다.

## 3. 구현 아이디어

### 3.1. 발동 시점

- `map.js`의 `transitionMap()` 함수가 호출되어 새로운 맵이 생성되고 플레이어가 이동을 완료한 직후에 발동시킵니다.
- 새로운 층에 진입할 때, 이전 층의 축복/저주 효과는 자동으로 제거되고 새로운 효과가 적용됩니다.
- (확장) 특정 몬스터 처치 시, 숨겨진 제단과 상호작용 시 등 특별한 조건에서 발동하는 이벤트도 추가할 수 있습니다.

### 3.2. 데이터 구조 (`blessingsAndCurses.js` 신규 파일 생성)

새로운 파일을 만들어 축복과 저주 효과들을 객체 형태로 관리합니다.

```javascript
export const BLESSINGS = {
  GIANT_STRENGTH: {
    name: "거인의 힘",
    description: "이번 층에서 힘이 20 증가합니다.",
    type: 'blessing',
    apply: (gameState) => { 
      gameState.playerStats.derived.strength += 20; 
    },
    remove: (gameState) => { 
      gameState.playerStats.derived.strength -= 20; 
    }
  },
  // ... 다른 축복들
};

export const CURSES = {
  BRITTLE_BONES: {
    name: "깨지기 쉬운 뼈",
    description: "이번 층에서 물리 방어력이 50% 감소합니다.",
    type: 'curse',
    apply: (gameState) => {
      // 임시로 효과를 저장할 객체가 필요
      const originalDefense = gameState.playerStats.derived.physicalDefense;
      gameState.playerStats.derived.physicalDefense *= 0.5;
      // 복원을 위해 원래 값을 저장
      gameState.activeCurseOriginalValue = originalDefense; 
    },
    remove: (gameState) => {
      // 저장했던 원래 값으로 복원
      gameState.playerStats.derived.physicalDefense = gameState.activeCurseOriginalValue;
    }
  },
  // ... 다른 저주들
};
```

- `apply` 함수: 플레이어의 스탯(`gameState.playerStats.derived`)을 직접 변경하거나, 게임의 다른 로직(아이템 드랍률 등)에 영향을 주는 플래그를 `gameState`에 설정합니다.
- `remove` 함수: `apply`로 적용했던 효과를 원래대로 되돌립니다. 스탯을 직접 변경한 경우, 해당 스탯을 다시 빼주거나 곱셈 효과의 경우 원래 값으로 복원하는 로직이 필요합니다.

### 3.3. 적용 로직 (`gameLogic.js` 수정)

`transitionMap` 함수 내부 또는 호출 직후에 다음 로직을 수행하는 함수를 만듭니다.

1. **기존 효과 제거:** `gameState`에 현재 적용 중인 축복/저주 정보가 있다면, 해당 효과의 `remove` 함수를 호출하여 초기화합니다.
2. **효과 확률 결정:** 예를 들어, 40% 확률로 축복, 40% 확률로 저주, 20% 확률로 아무 일도 일어나지 않도록 설정합니다.
3. **효과 선택:** 확률에 따라 `blessingsAndCurses.js` 파일에서 무작위로 효과 하나를 선택합니다.
4. **신규 효과 적용:** 선택된 효과의 `apply` 함수를 호출하고, `gameState.activeBlessingOrCurse` 같은 변수에 현재 적용된 효과의 정보를 저장합니다.
5. **UI 알림:** `ui.js`의 `logCombatMessage` 같은 함수를 사용하여 "축복: 거인의 힘을 받았습니다!" 와 같이 플레이어에게 어떤 효과가 적용되었는지 알려줍니다.

## 4. 효과 예시

### 축복 (Blessings)

- **거인의 힘:** 이번 층에서 힘 +20
- **매의 눈:** 이번 층에서 치명타 확률 +15%
- **황금 손길:** 이번 층에서 획득하는 골드 2배
- **지혜의 속삭임:** 이번 층에서 경험치 획득량 +25%
- **대장장이의 가호:** 이번 층에서 장비 강화 성공 확률 +20% (강화 시스템 추가 시)
- **빛의 걸음:** 이번 층에서 이동 속도 증가, 몬스터에게 발각될 확률 감소

### 저주 (Curses)

- **깨지기 쉬운 뼈:** 이번 층에서 물리 방어력 50% 감소
- **마나 누출:** 전투 중이 아닐 때 5초마다 마나 2씩 감소
- **무거운 짐:** 이번 층에서 모든 포션 아이템 사용 불가
- **어둠의 장막:** 시야가 좁아져 미니맵의 일부가 가려짐
- **쇠약:** 이번 층에서 모든 스탯 -5
- **탐욕의 대가:** 상점 아이템 가격 2배

이 시스템은 기존 코드의 수정은 최소화하면서도, 로그라이크의 핵심 재미를 크게 강화할 수 있는 좋은 선택이 될 것입니다.

---

# 로그라이크 신규 시스템 추천 2: "상호작용 가능한 구조물" (선택지 강화안)

## 1. 시스템 개요 (기존과 동일)

"상호작용 가능한 구조물" 시스템은 맵 곳곳에 무작위로 특별한 구조물을 배치하여 플레이어의 탐험에 재미와 깊이를 더하는 시스템입니다. 플레이어는 이 구조물들과 상호작용하여 다양한 결과를 얻게 되며, 이는 단순한 몬스터 사냥과 아이템 획득을 넘어선 새로운 경험을 제공합니다.

## 2. 핵심 컨셉 (기존과 동일)

- **탐험 동기 부여:** 맵을 구석구석 탐험해야 할 이유를 제공합니다.
- **위험과 보상 (Risk & Reward):** 모든 상호작용에는 결과가 따릅니다. 플레이어는 상호작용 여부를 신중하게 결정해야 합니다.
- **맵의 다양성 증대:** 매번 다른 위치에 다른 구조물이 나타나 맵이 단조롭지 않습니다.

## 3. 구현 아이디어 (수정됨)

### 3.1. 생성 시점 (기존과 동일)

- 맵 생성 로직에서 몬스터 등과 함께 무작위로 배치합니다.
- `gameState`에 `interactableStructures` 배열을 추가하여 위치와 정보를 저장합니다.

### 3.2. 상호작용 로직 (대폭 수정)

- **(트리거)** 플레이어가 구조물 **근처**로 이동한 후 **상호작용 키(예: 'E')**를 누르면 상호작용이 시작됩니다. 자동으로 발동되지 않아 플레이어가 준비할 시간을 가질 수 있습니다.
- **(UI 표시)** 상호작용이 시작되면, 화면 중앙에 **선택지 창(Modal UI)**이 나타납니다. 이 UI는 구조물의 이름, 설명, 그리고 플레이어가 할 수 있는 행동 버튼들로 구성됩니다.
- **(선택과 결과)** 플레이어가 버튼 중 하나를 클릭하면, 해당 선택에 따른 결과가 처리됩니다. 모든 구조물에는 상호작용을 취소하는 **"그냥 떠난다"** 선택지가 기본적으로 포함됩니다.

### 3.3. 데이터 구조 (`structures.js` 신규 파일, 수정된 구조)

선택지 UI를 지원하기 위해 데이터 구조를 확장합니다.

```javascript
// structures.js
import { showInteractionModal, hideInteractionModal } from './ui.js';
import { logCombatMessage } from './gameLogic.js';

export const STRUCTURES = {
  HEALING_FOUNTAIN: {
    id: 'HEALING_FOUNTAIN',
    name: "신비로운 샘",
    tile: 'IMAGE_OF_FOUNTAIN',
    description: "맑은 물이 솟아나는 샘을 발견했다. 물에서는 희미한 빛이 느껴진다.",
    // 'interact'는 이제 UI를 띄우는 역할만 담당
    interact: (structure) => {
      showInteractionModal(structure); // ui.js에 모달을 보여주는 함수 호출
    },
    // 선택지에 대한 로직을 choices 배열로 분리
    choices: [
      {
        text: "물을 마신다",
        action: (gameState) => {
          if (Math.random() < 0.7) { // 70% 확률
            gameState.playerStats.base.hp = gameState.playerStats.derived.maxHp;
            gameState.playerStats.base.mp = gameState.playerStats.derived.maxMp;
            logCombatMessage("샘물을 마시자 상처와 피로가 모두 회복되었다!");
          } else { // 30% 확률
            gameState.playerStats.base.hp = Math.max(1, gameState.playerStats.base.hp - 20);
            logCombatMessage("샘물이 오염되어 있었다! 20의 피해를 입었다.");
          }
          hideInteractionModal();
          // 구조물 비활성화 로직 추가
        }
      },
      {
        text: "그냥 떠난다",
        action: () => {
          logCombatMessage("조심스럽게 자리를 떠났다.");
          hideInteractionModal();
        }
      }
    ]
  },
  // ... 다른 구조물들
};
```
- `interact` 함수는 이제 UI를 띄우는 역할만 합니다.
- `choices` 배열을 새로 추가하여, 각 선택지의 `text`와 실행될 `action` 함수를 정의합니다.
- `ui.js`에는 이 `choices` 배열을 받아 버튼을 동적으로 생성하고, 각 버튼 클릭 시 해당 `action` 함수를 실행하는 로직이 필요합니다.

## 4. 구조물 및 선택지 예시 (수정됨)

- **신비로운 샘:**
    - 설명: "맑은 물이 솟아나는 샘을 발견했다."
    - 선택지 1: `[물을 마신다]` -> (70%) HP/MP 회복 / (30%) 피해
    - 선택지 2: `[그냥 떠난다]` -> 아무 일도 일어나지 않음.

- **희생의 제단:**
    - 설명: "오래된 제단 위에 무언가를 바치라는 문양이 새겨져 있다."
    - 선택지 1: `[체력의 30%를 바친다]` -> (60%) 강력한 축복 획득 / (40%) 저주 획득
    - 선택지 2: `[아이템을 바친다]` -> 무작위 아이템 하나 소멸, 대신 희귀 아이템 획득 또는 실패
    - 선택지 3: `[그냥 떠난다]`

- **잠긴 보물 상자:**
    - 설명: "육중한 자물쇠로 잠겨있는 보물 상자다."
    - 선택지 1: `[오래된 열쇠로 연다]` -> (열쇠가 있을 경우) 상자 개방, 좋은 보상 획득
    - 선택지 2: `[자물쇠를 부순다]` -> (힘 스탯에 따라 성공률 결정) 성공 시 보상 획득 / 실패 시 함정 발동
    - 선택지 3: `[그냥 떠난다]`

- **수수께끼의 석상:**
    - 설명: "지혜의 석상이다. 무언가 거래를 제안하는 듯하다."
    - 선택지 1: `[거래한다]` -> 무작위 스탯 +1, 다른 무작위 스탯 -1 (영구)
    - 선택지 2: `[그냥 떠난다]`

이처럼 플레이어에게 선택권을 제공하는 방식은 게임의 상호작용을 더욱 풍부하게 만들고, 플레이어의 결정에 따라 결과가 달라지는 로그라이크의 전략적 깊이를 더해줄 것입니다.

---

# 로그라이크 신규 시스템 추천 3: "숙련도 시스템"

## 1. 시스템 개요

"숙련도 시스템"은 플레이어가 특정 종류의 무기(예: 한손검, 활)나 마법(예: 화염 마법, 치유 마법)을 사용할수록 해당 분야에 대한 경험치가 쌓이고, 레벨이 오르면 영구적인 패시브 보너스를 얻게 되는 시스템입니다. 이는 플레이어의 플레이 스타일을 자연스럽게 캐릭터의 성장으로 연결해주고, 장기적인 성장의 재미를 제공합니다.

## 2. 핵심 컨셉

- **플레이스타일의 전문화:** 한 가지 분야를 꾸준히 사용하면 그 분야의 전문가가 될 수 있습니다. 이는 플레이어가 자신의 캐릭터 컨셉을 더욱 뚜렷하게 만들도록 유도합니다.
- **장기적인 성장 동기:** 레벨업 외에 새로운 성장 목표를 제공하여, 게임을 반복해서 플레이할 동기를 부여합니다.
- **능동적인 성장:** 단순히 몬스터를 잡는 것을 넘어, '어떤 방식'으로 잡느냐가 캐릭터의 성장에 직접적인 영향을 미치게 되어 전투에 깊이를 더합니다.

## 3. 구현 아이디어

### 3.1. 숙련도 경험치 획득

- **(무기)** 전투에서 특정 종류의 무기로 적을 성공적으로 타격할 때마다 해당 무기 숙련도 경험치를 획득합니다. (예: `gameLogic.js`의 `playerTurn` 또는 `calculateDamage` 함수 내부)
- **(마법)** 특정 계열의 마법 스킬을 사용할 때마다 해당 마법 숙련도 경험치를 획득합니다. (예: `gameLogic.js`의 `useSkill` 함수 내부)
- 획득량은 몬스터의 레벨이나 난이도에 따라 보너스를 줄 수 있습니다.

### 3.2. 데이터 구조

- **`gameState.js` 수정:** `playerStats.base` 객체 내에 `mastery` 객체를 추가하여 숙련도 레벨과 경험치를 저장합니다.

```javascript
// gameState.js 내 playerStats.base
mastery: {
    oneHandedSword: { level: 0, exp: 0, expToNextLevel: 100 },
    bow: { level: 0, exp: 0, expToNextLevel: 100 },
    fireMagic: { level: 0, exp: 0, expToNextLevel: 100 },
    healingMagic: { level: 0, exp: 0, expToNextLevel: 100 }
}
```

- **`mastery.js` 신규 파일 생성:** 숙련도 레벨별 보너스를 정의합니다.

```javascript
// mastery.js
export const MASTERY_BONUSES = {
    oneHandedSword: [
        { description: "공격 속도 +5%", effect: (derived) => derived.speed += 5 },
        { description: "물리 공격력 +10", effect: (derived) => derived.physicalAttack += 10 },
        { description: "3% 확률로 적 공격 회피", effect: (derived) => derived.evasion += 0.03 }
    ],
    fireMagic: [
        { description: "화염 마법 마나 소모량 -5%", effect: (derived) => derived.manaCostReduction = (derived.manaCostReduction || 0) + 0.05 },
        { description: "화염 마법 데미지 +10%", effect: (derived) => derived.elementalDamageBonus += 0.10 },
        { description: "화염 마법에 맞은 적에게 2턴간 '화상' 효과 부여", effect: (derived) => { /* 상태이상 로직 추가 */ } }
    ]
};
```

### 3.3. 적용 로직

1.  **경험치 획득 함수:** `gameLogic.js`에 `gainMasteryExp(category, amount)` 함수를 만듭니다. 이 함수는 경험치를 증가시키고, 경험치가 다 차면 레벨업 처리 후 `recalculateDerivedStats`를 호출합니다.
2.  **스탯 재계산 로직 수정:** `recalculateDerivedStats` 함수 마지막 부분에서, 플레이어의 모든 숙련도 레벨을 확인하고 `MASTERY_BONUSES`에 정의된 `effect` 함수를 호출하여 보너스를 `derived` 스탯에 적용합니다.
3.  **UI 추가:** 캐릭터 정보 창에 새로운 '숙련도' 탭을 추가하여, 현재 각 숙련도의 레벨, 경험치, 그리고 다음 레벨 보너스 등을 확인할 수 있게 합니다.

## 4. 숙련도 종류 및 보너스 예시

- **한손검 숙련도:**
    - Lv.1: 공격 속도 +5%
    - Lv.5: 물리 공격력 +15
    - Lv.10: 일정 확률로 적의 공격을 "받아치기(Parry)"하여 데미지 무효화 및 반격
- **활 숙련도:**
    - Lv.1: 명중률 +5%
    - Lv.5: 치명타 데미지 +20%
    - Lv.10: 공격 시 일정 확률로 "추가 화살" 발사 (50% 데미지)
- **화염 마법 숙련도:**
    - Lv.1: 화염 마법 마나 소모량 -5%
    - Lv.5: 화염 마법 데미지 +15%
    - Lv.10: 화염 마법이 치명타로 적중 시, 대상의 마법 저항력을 일시적으로 감소시킴
- **방어구 숙련도 (갑옷/방패):**
    - Lv.1: 물리 방어력 +5%
    - Lv.5: 최대 체력 +50
    - Lv.10: 피격 시 일정 확률로 '철벽' 효과 발동, 3초간 받는 모든 데미지 30% 감소

이 "숙련도 시스템"은 다른 시스템들과 잘 어우러져 플레이어가 자신의 캐릭터에 더욱 애착을 갖고, 다양한 플레이스타일을 시도하며 장기적으로 게임을 즐길 수 있는 훌륭한 기반이 될 것입니다.

