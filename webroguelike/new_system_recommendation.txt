# 로그라이크 신규 시스템 추천: "축복과 저주"

# 로그라이크 신규 시스템 추천 : "상호작용 가능한 구조물" (선택지 강화안)

## 1. 시스템 개요 (기존과 동일)

"상호작용 가능한 구조물" 시스템은 맵 곳곳에 무작위로 특별한 구조물을 배치하여 플레이어의 탐험에 재미와 깊이를 더하는 시스템입니다. 플레이어는 이 구조물들과 상호작용하여 다양한 결과를 얻게 되며, 이는 단순한 몬스터 사냥과 아이템 획득을 넘어선 새로운 경험을 제공합니다.

## 2. 핵심 컨셉 (기존과 동일)

- **탐험 동기 부여:** 맵을 구석구석 탐험해야 할 이유를 제공합니다.
- **위험과 보상 (Risk & Reward):** 모든 상호작용에는 결과가 따릅니다. 플레이어는 상호작용 여부를 신중하게 결정해야 합니다.
- **맵의 다양성 증대:** 매번 다른 위치에 다른 구조물이 나타나 맵이 단조롭지 않습니다.

## 3. 구현 아이디어 (수정됨)

### 3.1. 생성 시점 (기존과 동일)

- 맵 생성 로직에서 몬스터 등과 함께 무작위로 배치합니다.
- `gameState`에 `interactableStructures` 배열을 추가하여 위치와 정보를 저장합니다.

### 3.2. 상호작용 로직 (대폭 수정)

- **(트리거)** 플레이어가 구조물 **근처**로 이동한 후 **상호작용 키(예: 'E')**를 누르면 상호작용이 시작됩니다. 자동으로 발동되지 않아 플레이어가 준비할 시간을 가질 수 있습니다.
- **(UI 표시)** 상호작용이 시작되면, 화면 중앙에 **선택지 창(Modal UI)**이 나타납니다. 이 UI는 구조물의 이름, 설명, 그리고 플레이어가 할 수 있는 행동 버튼들로 구성됩니다.
- **(선택과 결과)** 플레이어가 버튼 중 하나를 클릭하면, 해당 선택에 따른 결과가 처리됩니다. 모든 구조물에는 상호작용을 취소하는 **"그냥 떠난다"** 선택지가 기본적으로 포함됩니다.

### 3.3. 데이터 구조 (`structures.js` 신규 파일, 수정된 구조)

선택지 UI를 지원하기 위해 데이터 구조를 확장합니다.

```javascript
// structures.js
import { showInteractionModal, hideInteractionModal } from './ui.js';
import { logCombatMessage } from './gameLogic.js';

export const STRUCTURES = {
  HEALING_FOUNTAIN: {
    id: 'HEALING_FOUNTAIN',
    name: "신비로운 샘",
    tile: 'IMAGE_OF_FOUNTAIN',
    description: "맑은 물이 솟아나는 샘을 발견했다. 물에서는 희미한 빛이 느껴진다.",
    // 'interact'는 이제 UI를 띄우는 역할만 담당
    interact: (structure) => {
      showInteractionModal(structure); // ui.js에 모달을 보여주는 함수 호출
    },
    // 선택지에 대한 로직을 choices 배열로 분리
    choices: [
      {
        text: "물을 마신다",
        action: (gameState) => {
          if (Math.random() < 0.7) { // 70% 확률
            gameState.playerStats.base.hp = gameState.playerStats.derived.maxHp;
            gameState.playerStats.base.mp = gameState.playerStats.derived.maxMp;
            logCombatMessage("샘물을 마시자 상처와 피로가 모두 회복되었다!");
          } else { // 30% 확률
            gameState.playerStats.base.hp = Math.max(1, gameState.playerStats.base.hp - 20);
            logCombatMessage("샘물이 오염되어 있었다! 20의 피해를 입었다.");
          }
          hideInteractionModal();
          // 구조물 비활성화 로직 추가
        }
      },
      {
        text: "그냥 떠난다",
        action: () => {
          logCombatMessage("조심스럽게 자리를 떠났다.");
          hideInteractionModal();
        }
      }
    ]
  },
  // ... 다른 구조물들
};
```
- `interact` 함수는 이제 UI를 띄우는 역할만 합니다.
- `choices` 배열을 새로 추가하여, 각 선택지의 `text`와 실행될 `action` 함수를 정의합니다.
- `ui.js`에는 이 `choices` 배열을 받아 버튼을 동적으로 생성하고, 각 버튼 클릭 시 해당 `action` 함수를 실행하는 로직이 필요합니다.

## 4. 구조물 및 선택지 예시 (수정됨)

- **신비로운 샘:**
    - 설명: "맑은 물이 솟아나는 샘을 발견했다."
    - 선택지 1: `[물을 마신다]` -> (70%) HP/MP 회복 / (30%) 피해
    - 선택지 2: `[그냥 떠난다]` -> 아무 일도 일어나지 않음.

- **희생의 제단:**
    - 설명: "오래된 제단 위에 무언가를 바치라는 문양이 새겨져 있다."
    - 선택지 1: `[체력의 30%를 바친다]` -> (60%) 강력한 축복 획득 / (40%) 저주 획득
    - 선택지 2: `[아이템을 바친다]` -> 무작위 아이템 하나 소멸, 대신 희귀 아이템 획득 또는 실패
    - 선택지 3: `[그냥 떠난다]`

- **잠긴 보물 상자:**
    - 설명: "육중한 자물쇠로 잠겨있는 보물 상자다."
    - 선택지 1: `[오래된 열쇠로 연다]` -> (열쇠가 있을 경우) 상자 개방, 좋은 보상 획득
    - 선택지 2: `[자물쇠를 부순다]` -> (힘 스탯에 따라 성공률 결정) 성공 시 보상 획득 / 실패 시 함정 발동
    - 선택지 3: `[그냥 떠난다]`

- **수수께끼의 석상:**
    - 설명: "지혜의 석상이다. 무언가 거래를 제안하는 듯하다."
    - 선택지 1: `[거래한다]` -> 무작위 스탯 +1, 다른 무작위 스탯 -1 (영구)
    - 선택지 2: `[그냥 떠난다]`

이처럼 플레이어에게 선택권을 제공하는 방식은 게임의 상호작용을 더욱 풍부하게 만들고, 플레이어의 결정에 따라 결과가 달라지는 로그라이크의 전략적 깊이를 더해줄 것입니다.

