# 몬스터 생성 고도화 계획

이 문서는 게임의 몬스터 생성 시스템을 더욱 복잡하고 흥미롭게 만들기 위한 계획을 설명합니다. 기존의 몬스터 생성 로직을 바탕으로 다음과 같은 기능들을 추가합니다.

---

## 1. 환경/지역(Biome) 기반 몬스터 생성

**개념:** 맵의 특정 환경(Biomes)에 따라 등장하는 몬스터의 종류를 제한하거나 선호도를 부여하여, 게임 세계의 몰입감을 높이고 지역별 특색을 강화합니다.

**세부 구현 계획:**
1.  **바이옴 정의:** `constants.js` 또는 새로운 설정 파일에 다양한 바이옴(예: 'ice_cave', 'volcanic_plains', 'forest', 'swamp')을 정의합니다.
2.  **맵에 바이옴 할당:** 맵 생성 시 현재 맵에 해당하는 바이옴을 결정하고, `gameState` 또는 `map` 객체에 해당 정보를 저장합니다.
3.  **몬스터에 바이옴 태그:** `constants.js`의 `MONSTER_TYPES` 각 몬스터 객체에 `biomes` 속성을 추가하여, 해당 몬스터가 등장할 수 있는 바이옴 목록을 명시합니다.
    *   예: `{ name: "ICE_DRAGON", archetype: 'elite', biomes: ['ice_cave', 'frozen_peak'] }`
4.  **`generateMonster` 함수 수정:**
    *   현재 맵의 바이옴 정보를 가져옵니다.
    *   `MONSTER_TYPES` 목록에서 현재 바이옴과 호환되는 몬스터만 필터링합니다.
    *   필터링된 목록에서 무작위로 몬스터를 선택하여 생성합니다.

**예상되는 영향:**
*   플레이어가 새로운 지역에 진입했을 때 새로운 유형의 몬스터를 만날 수 있게 되어 탐험의 재미를 더합니다.
*   몬스터 디자인과 맵 디자인의 일관성을 높입니다.

---

## 2. 몬스터 고유 능력/스킬 추가

**개념:** 몬스터가 단순한 공격 외에 자체적인 특수 능력이나 스킬(예: 치유, 디버프, 강화, 특수 공격)을 사용하도록 하여 전투의 깊이와 전략적 요소를 추가합니다.

**세부 구현 계획:**
1.  **능력 정의:** `constants.js`의 `MONSTER_TYPES` 각 몬스터 객체에 `abilities` 배열을 추가합니다. 각 능력은 `type` (능력 종류), `chance` (발동 확률), `target` (대상: self, player, random_ally 등), `effect` (능력 효과) 등의 속성을 가집니다.
    *   예: `{ name: "FROG_SHAMAN", ..., abilities: [{ type: 'heal', chance: 0.3, amount: 20, target: 'random_ally' }] }`
2.  **`monsterTurn` 함수 수정:**
    *   몬스터의 턴이 시작될 때, 해당 몬스터의 `abilities` 목록을 확인합니다.
    *   각 능력의 `chance`를 기반으로 능력을 발동할지 결정합니다.
    *   선택된 능력의 `type`과 `effect`에 따라 적절한 로직을 실행합니다.
3.  **능력 로직 구현:**
    *   **치유:** 몬스터 또는 아군 몬스터의 HP를 회복시킵니다.
    *   **디버프/상태 이상:** 플레이어에게 약화 효과(예: 독, 느려짐, 공격력 감소)를 적용합니다. `applyStatusEffect` 함수를 확장하여 몬스터에게도 적용 가능하도록 합니다.
    *   **강화:** 자신 또는 아군 몬스터의 스탯을 일시적으로 증가시킵니다.
    *   **특수 공격:** 일반 공격과 다른 추가 피해 또는 효과를 가진 공격을 수행합니다.
4.  **UI 피드백:** 몬스터가 능력을 사용했을 때 전투 로그나 시각적 효과를 통해 플레이어에게 알립니다.

**예상되는 영향:**
*   전투가 더욱 다양하고 예측 불가능해져서 플레이어가 몬스터의 패턴을 학습하고 대응 전략을 세우게 됩니다.
*   일부 몬스터는 최우선 처치 대상이 될 수 있습니다 (예: 치유하는 몬스터).

---

## 3. 플레이어 성과에 따른 동적 난이도 조절

**개념:** 플레이어의 레벨 외에 현재 플레이어의 전투력(장비 수준)과 게임 진행 속도(클리어 타임)를 고려하여 몬스터의 난이도를 유동적으로 조절합니다.

**세부 구현 계획:**
1.  **플레이어 성과 지표 추적:**
    *   `gameState.js`에 `playerPerformance` 객체를 추가합니다.
    *   `gearScore`: 플레이어가 장착한 모든 장비의 '예산(budget)' 값 합계 등을 기반으로 계산합니다. `recalculateDerivedStats` 함수 내에서 이 값을 업데이트합니다.
    *   `averageClearTime`: 이전 맵을 클리어하는 데 걸린 시간 등을 기록하여 플레이어의 진행 속도를 추정합니다.
2.  **동적 난이도 계수 (`challengeFactor`) 계산:**
    *   `generateMonster` 함수 내에서 `playerPerformance` 지표를 기반으로 동적인 `challengeFactor`를 계산합니다.
    *   `challengeFactor`는 플레이어 레벨에 추가되거나, 몬스터 티어 선택 확률에 보정을 주거나, 몬스터 스탯에 추가 배율을 적용하는 데 사용될 수 있습니다.
3.  **몬스터 등급/레벨 조정:**
    *   `generateMonster` 함수에서 몬스터의 티어(`tierKey`)를 결정하거나 몬스터 레벨(`monsterLevel`)을 결정하는 로직에 `challengeFactor`를 적용합니다.
    *   예: 플레이어의 `gearScore`가 매우 높으면 'elite' 또는 'champion' 티어의 몬스터 등장 확률을 미세하게 높입니다.

**예상되는 영향:**
*   플레이어가 너무 쉽게 진행하는 것을 방지하고, 반대로 너무 막히는 구간을 완화하여 적절한 난이도 밸런스를 유지합니다.
*   플레이어가 강해질수록 몬스터도 함께 강해지는 '성장형 난이도'를 구현합니다.

---

## 4. 몬스터 "무리(Pack)" 생성

**개념:** 몬스터를 개별적으로 생성하는 대신, 특정 몬스터들이 테마가 맞는 '무리'로 함께 등장하게 하여 전투를 더욱 복합적으로 만듭니다.

**세부 구현 계획:**
1.  **몬스터 무리 정의:** `constants.js`에 `MONSTER_PACKS` 배열을 추가합니다. 각 무리는 '리더' 몬스터와 '하수인(minions)' 몬스터들로 구성됩니다.
    *   예: `const MONSTER_PACKS = [{ name: 'Wolf Pack', leader: 'GREY_WOLF', minions: ['GREY_WOLF', 'GREY_WOLF', 'GREY_WOLF'], spawnChance: 0.1, maxPackSize: 4 }]`
2.  **`map.js`의 몬스터 스폰 로직 수정:**
    *   `MONSTER_SPAWN_COUNT` 만큼 몬스터를 생성하는 루프 내에서, 일정 확률(`spawnChance`)로 개별 몬스터 대신 `generateMonsterPack` 함수를 호출합니다.
3.  **`generateMonsterPack` 함수 구현 (새 함수):**
    *   무작위로 `MONSTER_PACKS` 중 하나를 선택합니다.
    *   맵에서 무리의 리더 몬스터를 위한 적절한 스폰 위치를 찾습니다.
    *   선택된 리더 몬스터를 생성합니다.
    *   리더 몬스터 주변의 인접한 타일들에 하수인 몬스터들을 생성합니다. 이 때 하수인 몬스터들의 스탯은 개별 스폰 시보다 약간 낮게 보정할 수 있습니다.
    *   하수인 몬스터들은 리더 몬스터와 시너지를 가지거나, 특정 능력을 공유할 수 있습니다.

**예상되는 영향:**
*   단조로운 1:1 전투에서 벗어나 다수의 적과 동시에 싸우는 상황을 연출합니다.
*   플레이어가 무리의 리더를 먼저 처치할지, 아니면 약한 하수인부터 정리할지 전략적 선택을 하도록 유도합니다.
*   맵에 몬스터를 배치하는 방식이 더욱 동적이고 흥미로워집니다.
